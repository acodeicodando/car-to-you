version: "3.8"
services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    depends_on:
      - database
      - redis
    ports:
      - "3000:3000"
    volumes:
      - .:/car-to-you
      - gem_cache:/usr/local/bundle/gems
      - node_modules:/car-to-you/node_modules
    env_file: .env
    environment:
      RAILS_ENV: development
    entrypoint: ./entrypoint.sh
  database:
    image: postgres:12.1
    volumes:
      - db_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
  redis:
    image: redis:5.0.7

volumes:
  gem_cache:
  db_data:
  node_modules:

# erro que aparece
# Traceback (most recent call last):
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/urllib3/connectionpool.py", line 670, in urlopen
#     httplib_response = self._make_request(
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/urllib3/connectionpool.py", line 392, in _make_request
#     conn.request(method, url, **httplib_request_kw)
#   File "/usr/local/Cellar/python@3.9/3.9.0_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1255, in request
#     self._send_request(method, url, body, headers, encode_chunked)
#   File "/usr/local/Cellar/python@3.9/3.9.0_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1301, in _send_request
#     self.endheaders(body, encode_chunked=encode_chunked)
#   File "/usr/local/Cellar/python@3.9/3.9.0_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1250, in endheaders
#     self._send_output(message_body, encode_chunked=encode_chunked)
#   File "/usr/local/Cellar/python@3.9/3.9.0_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1010, in _send_output
#     self.send(msg)
#   File "/usr/local/Cellar/python@3.9/3.9.0_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 950, in send
#     self.connect()
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/docker/transport/unixconn.py", line 43, in connect
#     sock.connect(self.unix_socket)
# FileNotFoundError: [Errno 2] No such file or directory

# During handling of the above exception, another exception occurred:

# Traceback (most recent call last):
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/requests/adapters.py", line 439, in send
#     resp = conn.urlopen(
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/urllib3/connectionpool.py", line 726, in urlopen
#     retries = retries.increment(
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/urllib3/util/retry.py", line 403, in increment
#     raise six.reraise(type(error), error, _stacktrace)
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/urllib3/packages/six.py", line 734, in reraise
#     raise value.with_traceback(tb)
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/urllib3/connectionpool.py", line 670, in urlopen
#     httplib_response = self._make_request(
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/urllib3/connectionpool.py", line 392, in _make_request
#     conn.request(method, url, **httplib_request_kw)
#   File "/usr/local/Cellar/python@3.9/3.9.0_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1255, in request
#     self._send_request(method, url, body, headers, encode_chunked)
#   File "/usr/local/Cellar/python@3.9/3.9.0_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1301, in _send_request
#     self.endheaders(body, encode_chunked=encode_chunked)
#   File "/usr/local/Cellar/python@3.9/3.9.0_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1250, in endheaders
#     self._send_output(message_body, encode_chunked=encode_chunked)
#   File "/usr/local/Cellar/python@3.9/3.9.0_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 1010, in _send_output
#     self.send(msg)
#   File "/usr/local/Cellar/python@3.9/3.9.0_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/http/client.py", line 950, in send
#     self.connect()
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/docker/transport/unixconn.py", line 43, in connect
#     sock.connect(self.unix_socket)
# urllib3.exceptions.ProtocolError: ('Connection aborted.', FileNotFoundError(2, 'No such file or directory'))

# During handling of the above exception, another exception occurred:

# Traceback (most recent call last):
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/docker/api/client.py", line 205, in _retrieve_server_version
#     return self.version(api_version=False)["ApiVersion"]
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/docker/api/daemon.py", line 181, in version
#     return self._result(self._get(url), json=True)
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/docker/utils/decorators.py", line 46, in inner
#     return f(self, *args, **kwargs)
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/docker/api/client.py", line 228, in _get
#     return self.get(url, **self._set_request_timeout(kwargs))
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/requests/sessions.py", line 543, in get
#     return self.request('GET', url, **kwargs)
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/requests/sessions.py", line 530, in request
#     resp = self.send(prep, **send_kwargs)
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/requests/sessions.py", line 643, in send
#     r = adapter.send(request, **kwargs)
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/requests/adapters.py", line 498, in send
#     raise ConnectionError(err, request=request)
# requests.exceptions.ConnectionError: ('Connection aborted.', FileNotFoundError(2, 'No such file or directory'))

# During handling of the above exception, another exception occurred:

# Traceback (most recent call last):
#   File "/usr/local/bin/docker-compose", line 33, in <module>
#     sys.exit(load_entry_point('docker-compose==1.27.4', 'console_scripts', 'docker-compose')())
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/compose/cli/main.py", line 67, in main
#     command()
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/compose/cli/main.py", line 123, in perform_command
#     project = project_from_options('.', options)
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/compose/cli/command.py", line 60, in project_from_options
#     return get_project(
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/compose/cli/command.py", line 131, in get_project
#     client = get_client(
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/compose/cli/docker_client.py", line 41, in get_client
#     client = docker_client(
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/compose/cli/docker_client.py", line 170, in docker_client
#     client = APIClient(**kwargs)
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/docker/api/client.py", line 188, in __init__
#     self._version = self._retrieve_server_version()
#   File "/usr/local/Cellar/docker-compose/1.27.4_1/libexec/lib/python3.9/site-packages/docker/api/client.py", line 212, in _retrieve_server_version
#     raise DockerException(
# docker.errors.DockerException: Error while fetching server API version: ('Connection aborted.', FileNotFoundError(2, 'No such file or directory'))
